# Load Balancer

## Load Balancer란?

여러 대의 서버나 네트워크 장치들 사이에서 부하를 분산시켜주는 역할을 한다  

- 대규모의 웹 사이트나 애플리케이션에서 사용자 요청이 많아질 경우 하나의 서버만으로는 요청을 처리하는데 한계가 발생한다  
로드 밸런서를 사용하여 여러 대의 서버에 요청을 분산시켜주면, 서버의 부하를 분산시켜 서비스의 안정성과 가용성을 높인다  

- 네트워크 트래픽을 관리하는 여러 가지 알고리즘을 사용하여 서버에 들어오는 요청을 적절히 분배한다  
  서버의 상태를 모니터링하고 문제가 발생할 경우 다른 서버에 요청을 전달한다  

## 로드밸런서가 필요한 이유

- 부하 분산
  서버의 부하 분산, 과부하를 방지, 서버의 성능 최적화  

- 고가용성
  하나의 서버가 다운되더라도 다른 서버가 처리 가능,서비스의 가용성 높임  

- 확장성
  서버의 부하가 증가할 때 새로운 서버를 추가하여 로드 밸런서에 등록 가능  
  => 유연한 서버용량 조정과 확장성 향상  

- 성능 개선

  - 알고리즘을 사용하여 요청을 적절히 분배, 서버의 성능을 최적화
  - 서버의 상태를 모니터링하여 문제가 발생한 경우 다른 서버로 요청을 전달

- 보안
  로드 밸런서를 사용하여 서버의 IP 주소를 숨겨 직접적인 공격을 방지

## 로드 밸런서가 서버를 선택하는 기준

- 라운드 로빈(Round Robin)
  서버들에게 균등하게 요청을 분배하여 각 서버가 동일한 부하를 갖도록 하는 알고리즘

- 가중 라운드 로빈(Weighted Round Robin)

  - 서버마다 가중치를 부여하여 부하 분산을 조절한다
  - 가중치가 높은 서버일수록 더 많은 요청을 받는다

- 최소 연결(Least Connections)

  - 현재 가장 적은 연결을 가진 서버에 요청을 보내는 알고리즘  
  - 연결 수가 가장 적은 서버에 요청을 보내기 때문에 현재 서버의 부하 상황을 고려한 방식

- IP 해시(IP Hash)

  - 클라이언트의 IP 주소를 해시 함수에 넣어서 나온 결과값에 따라 요청을 분배하는 알고리즘
  - 동일한 클라이언트는 항상 동일한 서버에 연결되도록 보장

- 최소 대기시간(Least Response Time)
  서버의 응답 시간을 측정하여 가장 빠른 응답 시간을 보이는 서버에 요청을 보내는 알고리즘

## 로드 밸런서 장애 대비

1. 로드 밸런서의 이중화
   - 여러 대의 로드 밸런서를 구성하여 서비스의 가용성 향상
   - 하나의 로드 밸런서가 장애가 발생해도 다른 로드 밸런서가 서비스를 대체 가능

2. 가용성 영역(availability zone) 분리
   가용성 영역을 분리하여 서버, 로드 밸런서를 여러 지역에 분산시켜 한 지역에서 장애가 발생하더라도 다른 지역에서 서비스 지속 가능

3. 헬스 체크(health check)
   서버의 상태를 확인하고 문제가 발생할 경우 자동으로 서비스에서 제외

4. 부하 분산 알고리즘 선택
   트래픽 패턴을 고려하여 적절한 알고리즘 선택

5. 자동 확장(auto-scaling)
   서버에 트래픽이 몰릴 때 자동으로 서버를 추가/제거하는 자동 확장 기능을 사용, 서비스의 가용성 향상

6. 백업 로드 밸런서
   주 로드 밸런서가 다운될 경우 백업 로드 밸런서로 이전 가능

7. 감시 및 경고
   로드 밸런서와 서버의 상태를 지속적으로 감시, 모니터링 시스템 구축

8. 예비 계획 수립
  - 로드 밸런서가 다운될 경우를 대비하여 예비 계획을 수립
  - 장애 복구 시간을 최소화하기 위해 예비 로드 밸런서를 미리 구성, 장애 발생 시 즉시 대응할 수 있는 프로세스 수립
